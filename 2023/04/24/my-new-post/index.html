<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>my new post | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="PG第一天: 攻打Empire-breakout首先需要连接到靶场第一种方式:打开 https:&#x2F;&#x2F;portal.offsec.com&#x2F;labs&#x2F;play  下载箭头所指 打开kali输入sudo openvpn .&#x2F;universal.ovpn sudo 允许普通用户以另一个用户（包括超级用户）的身份执行命令的工具 openvpn 是kali自带的软件, 通过网站上下载好的universal.o">
<meta property="og:type" content="article">
<meta property="og:title" content="my new post">
<meta property="og:url" content="http://example.com/2023/04/24/my-new-post/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="PG第一天: 攻打Empire-breakout首先需要连接到靶场第一种方式:打开 https:&#x2F;&#x2F;portal.offsec.com&#x2F;labs&#x2F;play  下载箭头所指 打开kali输入sudo openvpn .&#x2F;universal.ovpn sudo 允许普通用户以另一个用户（包括超级用户）的身份执行命令的工具 openvpn 是kali自带的软件, 通过网站上下载好的universal.o">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418131246178.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132641550.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132739898.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132209000.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132209000.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418135438025.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418140151622.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418135747816.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210420346.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210543972.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210621997.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210848383.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418211044452.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418211801375.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418212545355.png">
<meta property="og:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230419113611219.png">
<meta property="article:published_time" content="2023-04-24T08:48:55.000Z">
<meta property="article:modified_time" content="2023-04-24T08:51:04.219Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418131246178.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-my-new-post" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/24/my-new-post/" class="article-date">
  <time class="dt-published" datetime="2023-04-24T08:48:55.000Z" itemprop="datePublished">2023-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      my new post
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PG第一天-攻打Empire-breakout"><a href="#PG第一天-攻打Empire-breakout" class="headerlink" title="PG第一天: 攻打Empire-breakout"></a>PG第一天: 攻打Empire-breakout</h1><h2 id="首先需要连接到靶场"><a href="#首先需要连接到靶场" class="headerlink" title="首先需要连接到靶场"></a>首先需要连接到靶场</h2><h3 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式:"></a>第一种方式:</h3><p>打开 <a target="_blank" rel="noopener" href="https://portal.offsec.com/labs/play">https://portal.offsec.com/labs/play</a></p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418131246178.png" alt="image-20230418131246178"></p>
<p>下载箭头所指</p>
<p>打开kali输入<code>sudo openvpn ./universal.ovpn</code></p>
<p>sudo <strong>允许普通用户以另一个用户（包括超级用户）的身份执行命令的工具</strong></p>
<p>openvpn 是kali自带的软件, 通过网站上下载好的universal.ovpn文件来连接到PG的服务器(注: 命令行处于运行ing算还在连接,一旦能输命令了,就说明断开了,需要重新连接)</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132641550.png" alt="image-20230418132641550"></p>
<p>断开后显示: </p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132739898.png" alt="image-20230418132739898"></p>
<p>连接成功后按照下图打开靶机,192.168.171.238就是要攻击的ip,得到ip后使用ping 来尝试能不能ping通,ping不同就去看是不是openvpn断了或者,每天的免费时长到期了</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132209000.png" alt="image-20230418132209000"></p>
<h3 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式:"></a>第二种方式:</h3><p>打开 <a target="_blank" rel="noopener" href="https://portal.offsec.com/labs/play">https://portal.offsec.com/labs/play</a></p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418132209000.png" alt="image-20230418132209000"></p>
<p>他会给你打开一个网页版的kali,可以直接在里面操作</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>首先我们需要获得有哪些端口</p>
<h3 id="1-nmap-端口扫描之王"><a href="#1-nmap-端口扫描之王" class="headerlink" title="1.nmap(端口扫描之王)"></a>1.nmap(端口扫描之王)</h3><p><strong>nmap是一款非常强大的主机发现和端口扫描工具，而且nmap运用自带的脚本，还能完成漏洞检测，同时支持多平台。</strong></p>
<h4 id="nmap常用命令"><a href="#nmap常用命令" class="headerlink" title="nmap常用命令"></a>nmap常用命令</h4><h5 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h5><table>
<thead>
<tr>
<th>iR</th>
<th>随机选择目标</th>
</tr>
</thead>
<tbody><tr>
<td>-iL</td>
<td>从文件中加载IP地址</td>
</tr>
<tr>
<td>-sL</td>
<td>简单的扫描目标</td>
</tr>
<tr>
<td>-sn</td>
<td>Ping扫描-禁用端口扫描</td>
</tr>
<tr>
<td>-Pn</td>
<td>将所有主机视为在在线，跳过主机发现</td>
</tr>
<tr>
<td>-PS[portlist]</td>
<td>（TCP SYN ping） 需要root权限</td>
</tr>
<tr>
<td>-PA[portlist]</td>
<td>（TCP ACK ping）</td>
</tr>
<tr>
<td>-PU[portlist]</td>
<td>（UDP  ping）</td>
</tr>
<tr>
<td>-PY [portlist]</td>
<td>（SCTP ping）</td>
</tr>
<tr>
<td>-PE&#x2F;PP&#x2F;PM</td>
<td>ICMP回显，时间戳和网络掩码请求探测</td>
</tr>
<tr>
<td>-PS[portlist]</td>
<td>（TCP SYN ping） 需要root权限</td>
</tr>
<tr>
<td>-PA[portlist]</td>
<td>（TCP ACK ping）</td>
</tr>
<tr>
<td>-PU[portlist]</td>
<td>（UDP  ping）</td>
</tr>
<tr>
<td>-PY [portlist]</td>
<td>（SCTP ping）</td>
</tr>
<tr>
<td>-PE&#x2F;PP&#x2F;PM</td>
<td>ICMP回显，时间戳和网络掩码请求探测</td>
</tr>
<tr>
<td>-PO[协议列表]</td>
<td>IP协议Ping</td>
</tr>
<tr>
<td>-n&#x2F;-R</td>
<td>从不执行DNS解析&#x2F;始终解析[默认：有时]</td>
</tr>
<tr>
<td>–dns-servers</td>
<td>指定自定义DNS服务器</td>
</tr>
<tr>
<td>–system-dns</td>
<td>使用OS的dns服务器</td>
</tr>
<tr>
<td>–traceroute</td>
<td>跟踪到每个主机的跃点路径</td>
</tr>
</tbody></table>
<h5 id="扫描技术"><a href="#扫描技术" class="headerlink" title="扫描技术"></a>扫描技术</h5><table>
<thead>
<tr>
<th>-sS</th>
<th align="left">使用TCP的SYN进行扫描</th>
</tr>
</thead>
<tbody><tr>
<td>-sT</td>
<td align="left">使用TCP进行扫描</td>
</tr>
<tr>
<td>-sA</td>
<td align="left">使用TCP的ACK进行扫描</td>
</tr>
<tr>
<td>-sU</td>
<td align="left">UDP扫描</td>
</tr>
<tr>
<td>-sI</td>
<td align="left">le扫描</td>
</tr>
<tr>
<td>-sF</td>
<td align="left">FIN扫描</td>
</tr>
<tr>
<td>-b&lt;FTP中继主机&gt;</td>
<td align="left">TP反弹扫描</td>
</tr>
</tbody></table>
<h5 id="端口规格和扫描顺序"><a href="#端口规格和扫描顺序" class="headerlink" title="端口规格和扫描顺序"></a>端口规格和扫描顺序</h5><table>
<thead>
<tr>
<th>-p</th>
<th>扫描指定端口</th>
</tr>
</thead>
<tbody><tr>
<td>–exclude-ports</td>
<td>从扫描中排除指定端口</td>
</tr>
<tr>
<td>-f</td>
<td>快速模式-扫描比默认扫描更少的端口</td>
</tr>
<tr>
<td>-r</td>
<td>连续扫描端口-不随机化</td>
</tr>
<tr>
<td>–top-ports</td>
<td>扫描<number>最常用的端口</td>
</tr>
</tbody></table>
<h5 id="服务-x2F-版本探测"><a href="#服务-x2F-版本探测" class="headerlink" title="服务&#x2F;版本探测"></a>服务&#x2F;版本探测</h5><table>
<thead>
<tr>
<th>-sV</th>
<th>探测服务&#x2F;版本信息</th>
</tr>
</thead>
<tbody><tr>
<td>–version-intensity</td>
<td>设置版本扫描强度（0-9）</td>
</tr>
<tr>
<td>–version-all</td>
<td>尝试每个强度探测</td>
</tr>
<tr>
<td>–version-trace</td>
<td>显示详细的版本扫描活动（用于调试）</td>
</tr>
</tbody></table>
<h5 id="脚本扫描"><a href="#脚本扫描" class="headerlink" title="脚本扫描"></a>脚本扫描</h5><table>
<thead>
<tr>
<th>-SC</th>
<th>等效于 –script&#x3D;defult</th>
</tr>
</thead>
<tbody><tr>
<td>–script &#x3D; <lua scripts>,<lua scripts></td>
<td>以逗号分隔的目录，脚本文件或脚本类别</td>
</tr>
<tr>
<td>–script-args &#x3D; &lt;n1&#x3D;v1, n2&#x3D;v2</td>
<td>为脚本提供参数</td>
</tr>
<tr>
<td>–script-args-file&#x3D;文件名</td>
<td>从文件名中加载脚本参数</td>
</tr>
<tr>
<td>–script-trace</td>
<td>显示发送和接受的所有数据</td>
</tr>
<tr>
<td>–script-updatedb</td>
<td>更新脚本数据库</td>
</tr>
<tr>
<td>–script-help&#x3D;<luascripts></td>
<td>显示有关脚本的帮助</td>
</tr>
</tbody></table>
<h5 id="操作系统检测"><a href="#操作系统检测" class="headerlink" title="操作系统检测"></a>操作系统检测</h5><table>
<thead>
<tr>
<th>-o</th>
<th>启用os检测</th>
</tr>
</thead>
<tbody><tr>
<td>–osscan-limit</td>
<td>将os检测限制为可能的目标</td>
</tr>
<tr>
<td>–osscan-guess</td>
<td>推测操作系统检测结果</td>
</tr>
</tbody></table>
<h5 id="时间和性能"><a href="#时间和性能" class="headerlink" title="时间和性能"></a>时间和性能</h5><table>
<thead>
<tr>
<th>–host-timeout</th>
<th>设置超时时间</th>
</tr>
</thead>
<tbody><tr>
<td>–scan-delay</td>
<td>设置探测之间的时间间隔</td>
</tr>
<tr>
<td>-T  &lt;0-5&gt;</td>
<td>设置时间模板,值越小，IDS报警几率越低</td>
</tr>
</tbody></table>
<h5 id="防火墙-x2F-IDS规避和欺骗"><a href="#防火墙-x2F-IDS规避和欺骗" class="headerlink" title="防火墙&#x2F;IDS规避和欺骗"></a>防火墙&#x2F;IDS规避和欺骗</h5><table>
<thead>
<tr>
<th>-f</th>
<th>报文分段</th>
</tr>
</thead>
<tbody><tr>
<td>-s</td>
<td>欺骗源地址</td>
</tr>
<tr>
<td>-g</td>
<td>使用指定的本机端口</td>
</tr>
<tr>
<td>–proxies &lt;url,port&gt;</td>
<td>使用HTTP&#x2F;SOCK4代理</td>
</tr>
<tr>
<td>-data<hex string></td>
<td>想发送的数据包中追加自定义的负载</td>
</tr>
<tr>
<td>–data-string</td>
<td>将自定义的ACSII字符串附加到发送数据包中</td>
</tr>
<tr>
<td>–data-length</td>
<td>发送数据包时，附加随机数据</td>
</tr>
<tr>
<td>–spoof-mac</td>
<td>MAC地址欺骗</td>
</tr>
<tr>
<td>–badsum</td>
<td>发送带有虚假TCP&#x2F;UNP&#x2F;STCP校验和的数据包</td>
</tr>
</tbody></table>
<h5 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h5><table>
<thead>
<tr>
<th>-oN</th>
<th>标准输出</th>
</tr>
</thead>
<tbody><tr>
<td>-oX</td>
<td>XMl输出</td>
</tr>
<tr>
<td>-oS</td>
<td>script jlddi3</td>
</tr>
<tr>
<td>-oG</td>
<td>grepable</td>
</tr>
<tr>
<td>-oA</td>
<td>同时输出三种主要格式</td>
</tr>
<tr>
<td>-v</td>
<td>信息详细级别</td>
</tr>
<tr>
<td>-d</td>
<td>调试级别</td>
</tr>
<tr>
<td>–packet-trace</td>
<td>跟踪发送和接收的报文</td>
</tr>
<tr>
<td>–reason</td>
<td>显示端口处于特殊状态的</td>
</tr>
<tr>
<td>–open</td>
<td>仅显示开放的端口</td>
</tr>
</tbody></table>
<h5 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h5><table>
<thead>
<tr>
<th>-6</th>
<th>启动Ipv6扫描</th>
</tr>
</thead>
<tbody><tr>
<td>-A</td>
<td>启动Os检测，版本检测，脚本扫描和traceroute</td>
</tr>
<tr>
<td>-V</td>
<td>显示版本号</td>
</tr>
<tr>
<td>-h</td>
<td>帮助信息</td>
</tr>
</tbody></table>
<p>使用nmap -sC -sV -p- –open -oN [自己起的名字] [靶机地址] </p>
<p>-sV 获得服务版本详细信息  –open 仅显示开放的端口</p>
<p>-p 扫描指定端口 -p-扫描全部端口  -sC </p>
<p>查看到了3个端口: 80 10000 20000</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418135438025.png" alt="image-20230418135438025"></p>
<p>通过ip:端口号进去看看分别有什么内容</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418140151622.png" alt="image-20230418140151622"></p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418135747816.png" alt="image-20230418135747816"></p>
<p>发现可能是brainfuck 加密方式  </p>
<p>解密得到</p>
<p><code>.2uqPEfj3D&lt;P&#39;a-3</code></p>
<p>进入其他端口</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210420346.png" alt="image-20230418210420346"></p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210543972.png" alt="image-20230418210543972"></p>
<p>成功进入</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210621997.png" alt="image-20230418210621997"><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418210848383.png" alt="image-20230418210848383"></p>
<p>多次尝试后使用国外webmin默认的用户名cyber + .2uqPEfj3D&lt;P’a-3 尝试登录其他端口,成功进入20000端口,在网站左下角找到了shell</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418211044452.png" alt="image-20230418211044452"></p>
<p>完成了第一步: 进入终端</p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418211801375.png" alt="image-20230418211801375"></p>
<p>看看&#x2F;var&#x2F;backups有没有备份文件(没有道理,全是经验)</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230418212545355.png" alt="image-20230418212545355"></p>
<p>想到tar 有很高的权限,回到home目录</p>
<h4 id="2-getcap-setcap"><a href="#2-getcap-setcap" class="headerlink" title="2.getcap setcap"></a>2.getcap setcap</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">1. Linux是一种安全操作系统，它给普通用户尽可能低的权限，而把全部的系统权限赋予一个单一的帐户--root。root帐户用来管理系统、安装软件、管理帐户、运行某些服务、安装/卸载文件系统、管理用户、安装软件等。另外，普通用户的很多操作也需要root权限，这通过setuid实现。</span><br><span class="line"></span><br><span class="line">这种依赖单一帐户执行特权操作的方式加大了系统的面临风险，而需要root权限的程序可能只是为了一个单一的操作，例如：绑定到特权端口、打开一个</span><br><span class="line">只有root权限可以访问的文件。某些程序可能有安全漏洞，而如果程序不是以root的权限运行，其存在的漏洞就不可能对系统造成什么威胁。</span><br><span class="line"></span><br><span class="line">从2.1版开始，内核开发人员在Linux内核中加入了能力(capability)的概念。其目标是消除需要执行某些操作的程序对root帐户的依赖。从2.2版本的内核开始，这些代基本可以使用了，虽然还存在一些问题，但是方向是正确的。</span><br><span class="line"></span><br><span class="line">2. Linux内核能力详解</span><br><span class="line"></span><br><span class="line">传统UNIX的信任状模型非常简单，就是“超级用户对普通用户”模型。在这种模型中，一个进程要么什么都能做，要么几乎什么也不能做，这取决于进程</span><br><span class="line">的UID。如果一个进程需要执行绑定到私有端口、加载/卸载内核模块以及管理文件系统等操作时，就需要完全的root权限。很显然这样做对系统安全存在很</span><br><span class="line">大的威胁。UNIX系统中的SUID问题就是由这种信任状模型造成的。例如，一个普通用户需要使用ping命令。这是一个SUID命令，会以root的权</span><br><span class="line">限运行。而实际上这个程序只是需要RAW套接字建立必要ICMP数据包，除此之外的其它root权限对这个程序都是没有必要的。如果程序编写不好，就可能</span><br><span class="line">被攻击者利用，获得系统的控制权。</span><br><span class="line"></span><br><span class="line">使用能力(capability)可以减小这种风险。系统管理员为了系统的安全可以剥夺root用户的能力，这样即使root用户也将无法进行某些</span><br><span class="line">操作。而这个过程又是不可逆的，也就是说如果一种能力被删除，除非重新启动系统，否则即使root用户也无法重新添加被删除的能力。</span><br><span class="line"></span><br><span class="line">3. 权限说明</span><br><span class="line">Capabilities的主要思想在于分割root用户的特权，即将root的特权分割成不同的能力，每种能力代表一定的特权操作。例如：能力CAP_SYS_MODULE表示用户能够加载(或卸载)内核模块的特权操作，而CAP_SETUID表示用户能够修改进程用户身份的特权操作。在Capbilities中系统将根据进程拥有的能力来进行特权操作的访问控制。</span><br><span class="line">    在Capilities中，只有进程和可执行文件才具有能力，每个进程拥有三组能力集，分别称为cap_effective, cap_inheritable, cap_permitted(分别简记为:pE,pI,pP)，其中cap_permitted表示进程所拥有的最大能力集；cap_effective表示进程当前可用的能力集，可以看做是cap_permitted的一个子集；而cap_inheitable则表示进程可以传递给其子进程的能力集。系统根据进程的cap_effective能力集进行访问控制，cap_effective为cap_permitted的子集，进程可以通过取消cap_effective中的某些能力来放弃进程的一些特权。可执行文件也拥有三组能力集，对应于进程的三组能力集，分别称为cap_effective, cap_allowed 和 cap_forced（分别简记为fE,fI,fP），其中，cap_allowed表示程序运行时可从原进程的cap_inheritable中集成的能力集，cap_forced表示运行文件时必须拥有才能完成其服务的能力集；而cap_effective则表示文件开始运行时可以使用的能力。</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"> Linux内核从2.2版本开始，就加进的Capabilities的概念与机制，并随着版本升高逐步得到改进。在linux中，root权限被分割成一下29中能力：</span><br><span class="line"></span><br><span class="line">CAP_CHOWN:修改文件属主的权限</span><br><span class="line">CAP_DAC_OVERRIDE:忽略文件的DAC访问限制</span><br><span class="line">CAP_DAC_READ_SEARCH:忽略文件读及目录搜索的DAC访问限制</span><br><span class="line">CAP_FOWNER：忽略文件属主ID必须和进程用户ID相匹配的限制</span><br><span class="line">CAP_FSETID:允许设置文件的setuid位</span><br><span class="line">CAP_KILL:允许对不属于自己的进程发送信号</span><br><span class="line">CAP_SETGID:允许改变进程的组ID</span><br><span class="line">CAP_SETUID:允许改变进程的用户ID</span><br><span class="line">CAP_SETPCAP:允许向其他进程转移能力以及删除其他进程的能力</span><br><span class="line">CAP_LINUX_IMMUTABLE:允许修改文件的IMMUTABLE和APPEND属性标志</span><br><span class="line">CAP_NET_BIND_SERVICE:允许绑定到小于1024的端口</span><br><span class="line">CAP_NET_BROADCAST:允许网络广播和多播访问</span><br><span class="line">CAP_NET_ADMIN:允许执行网络管理任务</span><br><span class="line">CAP_NET_RAW:允许使用原始套接字</span><br><span class="line">CAP_IPC_LOCK:允许锁定共享内存片段</span><br><span class="line">CAP_IPC_OWNER:忽略IPC所有权检查</span><br><span class="line">CAP_SYS_MODULE:允许插入和删除内核模块</span><br><span class="line">CAP_SYS_RAWIO:允许直接访问/devport,/dev/mem,/dev/kmem及原始块设备</span><br><span class="line">CAP_SYS_CHROOT:允许使用chroot()系统调用</span><br><span class="line">CAP_SYS_PTRACE:允许跟踪任何进程</span><br><span class="line">CAP_SYS_PACCT:允许执行进程的BSD式审计</span><br><span class="line">CAP_SYS_ADMIN:允许执行系统管理任务，如加载或卸载文件系统、设置磁盘配额等</span><br><span class="line">CAP_SYS_BOOT:允许重新启动系统</span><br><span class="line">CAP_SYS_NICE:允许提升优先级及设置其他进程的优先级</span><br><span class="line">CAP_SYS_RESOURCE:忽略资源限制</span><br><span class="line">CAP_SYS_TIME:允许改变系统时钟</span><br><span class="line">CAP_SYS_TTY_CONFIG:允许配置TTY设备</span><br><span class="line">CAP_MKNOD:允许使用mknod()系统调用</span><br><span class="line">CAP_LEASE:允许修改文件锁的FL_LEASE标志</span><br><span class="line"></span><br><span class="line">cap_chown=eip是将chown的能力以cap_effective(e),cap_inheritable(i),cap_permitted(p)三种位图的方式授权给相关的程序文件.</span><br><span class="line"></span><br><span class="line">从Linux中第一次启动Wireshark的时候，可能会觉得奇怪，为什么看不到任何一个网卡，比如eth0之类的。这是因为，直接访问这些设备需要 root权限。然后，我就用root权限去用了。当然，这是一个不好的做法。比如Gentoo中就会提示：WIRESHARK CONTAINS OVER ONE POINT FIVE MILLION LINES OF SOURCE CODE. DO NOT RUN THEM AS ROOT.</span><br><span class="line"></span><br><span class="line">那怎么办呢？Wireshark的leader Gerald Combs指出，现在多数Linux发行版都开始实现对raw网络设备使用文件系统权限（能力） ，可以用这个途径从普通用户启动Wireshark。</span><br><span class="line"></span><br><span class="line">4.具体步骤：</span><br><span class="line">1).安装setcap。setcap 是libcap2-bin包的一部分，一般来说，这个包默认会已经装好。</span><br><span class="line">sudo apt-get install libcap2-bin</span><br><span class="line"></span><br><span class="line">2).创建Wireshark组。这一步在安装Wireshark的时候，也会完成。</span><br><span class="line"># groupadd -g wireshark</span><br><span class="line"></span><br><span class="line"># usermod -a -G wireshark &lt;自己的用户名&gt;</span><br><span class="line"></span><br><span class="line"># chgrp wireshark /usr/bin/dumpcap</span><br><span class="line"></span><br><span class="line"># chmod 4750 /usr/bin/dumpcap</span><br><span class="line"></span><br><span class="line">3).赋予权限。</span><br><span class="line">#setcap cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap 完成。</span><br><span class="line">可以使用 getcap /usr/bin/dumpcap验证，输出应当是：/usr/bin/dumpcap = cap_net_admin,cap_net_raw+eip</span><br><span class="line"></span><br><span class="line">现在就可以从自己的普通用户启动Wireshark抓包了</span><br></pre></td></tr></table></figure>

<p>通过.&#x2F;tar(CAP_DAC_READ_SEARCH:忽略文件读及目录搜索的DAC访问限制) 命令来将本来是root权限的.old_pass.bak 降权到普通用户,我们就可以查看内容为  <code>Ts&amp;4&amp;YurgtRX(=~h</code></p>
<p>cat local.txt</p>
<p>找到了第一个flag</p>
<p>在执行完.&#x2F;tar -cf pass.tar &#x2F;var&#x2F;backups&#x2F;.old_pass.bak</p>
<p>tar -xf  pass.tar</p>
<p>就可以cat var&#x2F;backups&#x2F;.old_pass.bak</p>
<p>得到<code>Ts&amp;4&amp;YurgtRX(=~h</code></p>
<p>以为找到了flag,尝试之后发现不是,想到10000端口也是一个登录界面,多次尝试后使用root + Ts&amp;4&amp;YurgtRX(&#x3D;~h 成功登录</p>
<p><img src="C:\Users\25709\AppData\Roaming\Typora\typora-user-images\image-20230419113611219.png" alt="image-20230419113611219"></p>
<p>同样通过左下角进入终端,cat后发现proof.txt就是flag,成功通过</p>
<p><code>4bcadfaf305a00ea74ee938cf3b023d0</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/04/24/my-new-post/" data-id="clgulmqn50000v8ug0n0qhtmy" data-title="my new post" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2023/04/24/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/24/my-new-post/">my new post</a>
          </li>
        
          <li>
            <a href="/2023/04/24/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>